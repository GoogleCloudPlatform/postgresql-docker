# Copyright (c) 2017, Google Inc.
#
# Permission to use, copy,
# modify, and distribute this software and its documentation for any purpose,
# without fee, and without a written agreement is hereby granted, provided that
# the above copyright notice and this paragraph and the following two paragraphs
# appear in all copies.
#
# IN NO EVENT SHALL GOOGLE BE LIABLE TO ANY PARTY
# FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING
# LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION,
# EVEN IF GOOGLE HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# GOOGLE SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT
# NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
# PARTICULAR PURPOSE. THE SOFTWARE PROVIDED HEREUNDER IS ON AN "AS IS" BASIS,
# AND GOOGLE HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
# ENHANCEMENTS, OR MODIFICATIONS.

setup:
- command:
    - touch /tmp/init-script.sh && echo 'touch /tmp/functional_tests.lock' > /tmp/init-script.sh
- command:
    - chmod
    - 644
    - '/tmp/init-script.sh'
- command:
    - docker
    - run
    - '--privileged=true'
    - '--name=some-postgres'
    - '--detach'
    - '--volume=/tmp/init-script.sh:/docker-entrypoint-initdb.d/init-script.sh'
    - '$IMAGE'
- command:
    - sleep
    - 15s

teardown:
- command: [docker, stop, some-postgres]
- command: [docker, rm, some-postgres]

target: some-postgres
tests:
- name: Does lock file exists
  command: [test, -f, '/tmp/functional_tests.lock']
